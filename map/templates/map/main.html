{% extends 'donation/navfull.html' %}
{% block content %}

{% if user.is_authenticated and user.helpseekerprofile %}
<!-- Toggle Button -->
<p><button onclick="resourceFilter('shelter')" class="btn btn-wide btn-dark">Shelter</button></p>
<p><button onclick="resourceFilter('wifi')" class="btn btn-wide btn-dark">Internet</button></p>

<!--Geocoding-->
<script src="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css" rel="stylesheet" />

<!-- Load Map -->
<section role="main">
  <div class="row">
    <div id='map'></div>
  </div>
</section>
<div class="clearfix"></div>
<nav id="filter-group" class="filter-group"></nav>

<script>
  mapboxgl.accessToken = '{{ mapbox_access_token }}'
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/jginmb7/ckgg1lsi02e2m1ao7bk8ov89z',
    center: [-73.935242, 40.730610],
    zoom: 9.5
  })
</script>

{% for post in post_context %}
<script>
  personal_donation_html = "<div class='container donation-popup'>" +
    "<h5 class='mb-3'><b>{{ post.title }}</b> * {{ post.quantity }}</h5>" +
    "<div class='row'>" +
    "<div class='col'>" +
    "<p>{{ post.description }}</p>" +
    "<p><img src='{{ post.image.url }}' /></p>" +
    "</div><div class='col'>" +
    "<p>{{ post.dropoff_time_1 }}</p>" +
    "<p>{{ post.dropoff_time_2 }}</p>" +
    "<p>{{ post.dropoff_time_3 }}</p>" +
    "</div></div>" +
    "<a href='/' class='btn btn-dark btn-wide' type='submit'>" +
    "Detail</button></a>"
  new mapboxgl.Marker({ "color": 'blue' })
    .setLngLat([{{ post.dropoff_location.longitude }},
    {{ post.dropoff_location.latitude }}])
    .setPopup(new mapboxgl.Popup({ offset: 25 })
      .setHTML(personal_donation_html))
    .addTo(map)
</script>
{% endfor %}

<!-- shelter data-->
{% for center in shelter_geojson %}
<script>
  var el = document.createElement('div');
  el.className = 'shelter-marker';
  //make a marker for each feature and add to the map
  new mapboxgl.Marker(el)
    .setLngLat({{ center.geometry.coordinates.0 }})
    .setPopup(new mapboxgl.Popup({ offset: 50 })
      .setHTML(
        "<div class='container'>" +
        "<h5 class='mb-3'><b>{{center.properties.center_name}}</b></h5>" +
        "<div class='row'>" +
        "<div class='col'>" +
        "<p>Address: <b>{{center.properties.address}}</b></p>" +
        "<p>Borough: <b>{{center.properties.borough}}</b></p>" +
        "</div><div class='col'>" +
        "<p>Zip: <b>{{center.properties.postcode}}</b></p>" +
        "<p>Hours: <b>{{center.properties.comments}}</b></p>" +
        "</div></div></div>"
      ))
    .addTo(map);
</script>
{% endfor %}

{% for center in internet_centers %}
<script>
  var wifiEl = document.createElement('div');
  wifiEl.className = 'wifi-marker';
  //"color": "#7DCEA0"
  new mapboxgl.Marker(wifiEl)
    .setLngLat([{{ center.longitude }}, {{ center.latitude }}])
    .setPopup(new mapboxgl.Popup({ offset: 50 })
      .setHTML(
        "<div class='container'>" +
        "<h5 class='mb-3'><b>{{center.name}}</b></h5>" +
        "<div class='row'>" +
        "<div class='col'>" +
        "<p>Provider: <b>{{center.provider}}</b></p>" +
        "<p>Location: <b>{{center.location}}</b></p>" +
        "</div><div class='col'>" +
        "<p>Borough: <b>{{center.boroname}}</b></p>" +
        "<p>Type: <b>{{center.type}}</b></p>" +
        "<p>Remarks: <b>{{center.remarks}}</b></p>" +
        "</div></div></div>"
      ))
    .addTo(map)
</script>
{% endfor %}

{% for center in computer_centers %}
<script>
  //var parkEl = document.createElement('div');
  //parkEl.className = 'park-marker';
  //"color": "#7DCEA0"
  new mapboxgl.Marker({ "color": 'red' })
    .setLngLat([{{ center.lon }}, {{ center.lat }}])
    .setPopup(new mapboxgl.Popup({ offset: 50 })
      .setHTML(
        "<div class='container'>" +
        "<h5 class='mb-3'><b>{{center.name}}</b></h5>" +
        "<div class='row'>" +
        "<div class='col'>" +
        "<p>Provider: <b>{{center.provider}}</b></p>" +
        "<p>Location: <b>{{center.location}}</b></p>" +
        "</div><div class='col'>" +
        "<p>Borough: <b>{{center.boroname}}</b></p>" +
        "<p>Type: <b>{{center.type}}</b></p>" +
        "<p>Remarks: <b>{{center.remarks}}</b></p>" +
        "</div></div></div>"
      ))
    .addTo(map)
</script>
{% endfor %}

{% for center in after_school_prgms %}
<script>
  //var parkEl = document.createElement('div');
  //parkEl.className = 'park-marker';
  //"color": "#7DCEA0"
  new mapboxgl.Marker({ "color": 'orange' })
    .setLngLat([{{ center.location_1.longitude }}, {{ center.location_1.latitude }}])
    .setPopup(new mapboxgl.Popup({ offset: 50 })
      .setHTML(
        "<div class='container'>" +
        "<h5 class='mb-3'><b>{{center.name}}</b></h5>" +
        "<div class='row'>" +
        "<div class='col'>" +
        "<p>Provider: <b>{{center.provider}}</b></p>" +
        "<p>Location: <b>{{center.location}}</b></p>" +
        "</div><div class='col'>" +
        "<p>Borough: <b>{{center.boroname}}</b></p>" +
        "<p>Type: <b>{{center.type}}</b></p>" +
        "<p>Remarks: <b>{{center.remarks}}</b></p>" +
        "</div></div></div>"
      ))
    .addTo(map)
</script>
{% endfor %}

<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link
rel="stylesheet"
href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
type="text/css"
/>
<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<div id="map"></div>



<script>

  var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
      mapboxClient.geocoding
      .forwardGeocode({
        query: 'Glenwood Road, East 100 & East 101 streets, Brooklyn,New York, United States',
        autocomplete: false,
        limit: 1
      })
      .send()
      .then(function (response) {
if (
response &&
response.body &&
response.body.features &&
response.body.features.length
) {
  var feature = response.body.features[0]; 
    new mapboxgl.Marker({ "color": 'yellow' })
    .setLngLat(feature.center)
    .setPopup(new mapboxgl.Popup({ offset: 50 })
    .setHTML(
        "<div class='container'>" +
        "<h5 class='mb-3'><b>{{center1.name}}</b></h5>" +
        "<div class='row'>" +
        "<div class='col'>" +
        "</div></div></div>"
      ))
    .addTo(map);
    
    });
</script>


<script>
  function resourceFilter(recourceCategory) {
    var filterClass = recourceCategory + "-marker"
    var shelters = document.getElementsByClassName(filterClass);
    // console.log(x);
    for (i = 0; i < shelters.length; i++) {
      if (shelters[i].classList.contains("hide")) {
        shelters[i].classList.remove("hide");
      } else {
        shelters[i].classList.add("hide");
      }
    }
  }
</script>
{% elif user.donorprofile %}

<!-- <html>
<head>
  <script type="text/javascript">
    function Redirect() {
      window.location = "{{DOMAIN_NAME}}" + "/donation/";
    }
    setTimeout('Redirect()', 0);
  </script>
</head>

<body>
</body>

</html>
{% endif %}
{% endblock content %}